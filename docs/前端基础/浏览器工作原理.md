# 浏览器工作原理

> 浏览器是怎么工作的？
> 简易答案：当我们从一个特定的网站请求一个网页时，浏览器从网络服务器检索必要的内容，然后在我们的设备上显示该内容。


## 导航

导航是加载网页的第一步。指的是当用户通过点击一个链接、在浏览器地址栏中写下一个网址、提交一个表格等方式请求一个网页时发生的过程

### DNS解析

导航到一个网页的第一步是找到该网页的静态资源位置（HTML、CSS、Javascript和其他类型的文件）。如果我们导航到 example.com ，HTML 页面位于 IP 地址为 93.184.216.34 的服务器上（对我们来说，网站是域名，但对计算机来说，它们是 IP 地址）。如果我们以前从未访问过这个网站，就必须进行域名系统（DNS）查询。

> DNS 服务器是包含公共 IP 地址及其相关主机名数据库的计算机服务器（这通常被比作电话簿，因为人们的名字与一个特定的电话号码相关联）。在大多数情况下，这些服务器按照要求将这些名字解析或翻译成 IP 地址（现在有 600 多个不同的 DNS 根服务器分布在世界各地）。

因此，当我们请求进行 DNS 查询时，我们实际做的是与这些服务器中的一个进行对话，要求找出与example.com 名称相对应的IP地址。如果找到了一个对应的 IP，就会返回。如果发生了一些情况，查找不成功，我们会在浏览器中看到一些错误信息。

### TCP (Transmission Control Protocol) 握手

一旦浏览器知道了网站的 IP 地址，它将尝试通过 TCP 三次握手（也称为 SYN-SYN-ACK，或者更准确的说是 SYN、SYN-ACK、ACK，因为 TCP 有三个消息传输，用于协商和启动两台计算机之间的TCP 会话），与持有资源的服务器建立连接。

> TCP 是传输控制协议的缩写，是一种通信标准，使应用程序和计算设备能够在网络上交换信息。它被设计用来在互联网上发送数据包，并确保数据和信息在网络上成功传递。

TCP 握手是一种机制，旨在让两个想要相互传递信息的实体（在我们的例子中是浏览器和服务器）在传输数据之前协商好连接的参数。

### TLS协商

对于通过 HTTPS 建立的安全连接，需要进行另一次握手。这种握手（TLS协商）决定了哪个密码将被用于加密通信，验证服务器，并在开始实际的数据传输之前建立一个安全的连接。

> 传输层安全（TLS）是现已废弃的安全套接字层（SSL）的继任者，是一种加密协议，旨在通过计算机网络提供通信安全。该协议被广泛用于电子邮件和即时通讯等应用，但它在确保 HTTPS安全方面的应用仍然是最公开的。由于应用程序可以使用或不使用 TLS（或SSL）进行通信，因此客户（浏览器）有必要要求服务器建立 TLS 连接。

在这一步骤中，浏览器和服务器之间还交换了一些信息

1. 客户端 hello。浏览器向服务器发送一条信息，其中包括它所支持的TLS版本和密码套件，以及一串随机字节，称为 客户端随机数。
2. 服务器 hello 和证书。服务器发回一条信息，其中包括服务器的SSL证书、服务器选择的密码套件和服务器随机数，这是服务器生成的另一个随机字节串。
3. 认证。浏览器会向颁发证书的机构核实服务器的 SSL 证书。这样，浏览器就可以确定服务器就是它所说的那个人。
4. 预主密码。浏览器会再发送一串随机的字节，称为主密钥，用浏览器从服务器的 SSL 证书上获取的公钥进行加密。主密码只能由服务器用私钥解密。
5. 使用私钥。服务器解密预主密码。
6. 创建会话密钥。浏览器和服务器从客户端随机数、服务器随机数和预主密码中生成会话密钥。
7. 客户端完成。浏览器向服务器发送一个消息，说它已经完成。
8. 服务器完成。服务器向浏览器发送一个消息，表示它也完成了。
9. 安全对称加密实现。握手完成，通信可以继续使用会话密钥。

现在可以开始从服务器请求和接收数据了


## 获取数据

### HTTP请求

在我们与服务器建立安全连接后，浏览器将发送一个初始的 HTTP GET 请求。首先，浏览器将请求页面的 HTML 文件。它将使用 HTTP 协议来做这件事。

> HTTP（超文本传输协议）是一个获取资源的协议，如HTML文件。它是网络上任何数据交换的基础，它是一个客户-服务器协议，这意味着请求是由接收者发起的，通常是网络浏览器。

HTTP 请求包含了我们想要的资源的地址（URL），以及一些其他信息，如浏览器类型、语言、编码等。服务器收到请求后，将返回一个 HTTP 响应。

一个 HTTP 请求通常包含以下部分：

1. **请求行**：包含请求方法（如 GET、POST）、请求的 URL 和 HTTP 版本。
2. **请求头**：包含关于客户端的信息，如浏览器类型、接受的内容类型等。
3. **请求体**：在某些情况下（如 POST 请求），包含要发送到服务器的数据。
4. **空行**：用于分隔请求头和请求体。
5. **请求参数**：如果有的话，包含在 URL 中的查询字符串。
6. **Cookies**：如果有的话，包含在请求头中的 Cookies。
7. **认证信息**：如果需要身份验证，包含在请求头中的认证信息。
8. **其他自定义头**：可以包含任何其他自定义的请求头。


### HTTP响应

一旦服务器收到请求，它将对其进行处理并回复一个 HTTP 响应。在响应的正文中，我们可以找到所有相关的响应头和我们请求的HTML文档的内容

## 解析HTML

### 词法分析

词法分析是将 HTML 文档转换为一系列标记（tokens）的过程。每个标记代表 HTML 文档中的一个元素或属性。词法分析器会读取 HTML 文档的字符流，并将其转换为标记流。

词法分析的结果一般是一系列以下标签：DOCTYPE、开始标签 (<tag>)、结束标签(</tag>)、自闭合标签 (<tag/>) 、属性名称、值、注释、字符、文件结尾或元素中的纯文本内容。

### 构建DOM树

DOM（文档对象模型）树是浏览器解析 HTML 文档后生成的一个树状结构。每个 HTML 元素都被表示为一个节点，节点之间的关系反映了 HTML 文档的结构。



## 解析CSS

